<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HBURN_v30.8_STABLE</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.13.2/ethers.umd.min.js"></script>
    <style>
        :root { --p: #00ff88; --s: #ff3366; --bg: #000; --glass: rgba(10, 10, 12, 0.98); --net: #008cff; --xcm: #e6007a; --dim: #333; }
        * { box-sizing: border-box; transition: all 0.2s ease; }
        body, html { margin: 0; padding: 0; height: 100vh; background: var(--bg); color: #fff; font-family: 'JetBrains Mono', monospace; overflow: hidden; }

        #canvas { position: fixed; top: 0; left: 0; z-index: 1; opacity: 0.15; pointer-events: none; }

        /* LOGIN */
        #auth { position: fixed; inset: 0; background: #000; z-index: 1000; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .auth-card { width: 400px; background: #050505; padding: 40px; border: 1px solid #111; text-align: center; }
        .auth-input { background: transparent; border: none; border-bottom: 1px solid #222; color: var(--p); width: 100%; padding: 15px; text-align: center; font-size: 13px; margin-bottom: 25px; outline: none; }

        /* LAYOUT */
        .container { position: relative; z-index: 10; width: 100vw; height: 100vh; display: grid; grid-template-columns: 300px 1fr 300px; background: var(--glass); }
        .col { padding: 25px; display: flex; flex-direction: column; border-right: 1px solid rgba(255,255,255,0.05); height: 100%; overflow: hidden; }
        
        /* BLOCK STREAM */
        #blockStream { flex-grow: 1; overflow-y: hidden; display: flex; flex-direction: column; gap: 10px; padding: 10px; position: relative; }
        .block-unit { 
            background: rgba(255,255,255,0.03); border: 1px solid #222; padding: 15px; 
            border-left: 3px solid var(--p); animation: slideIn 0.4s ease-out; 
            display: grid; grid-template-columns: 100px 1fr 100px; align-items: center;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        
        .label { font-size: 8px; color: #666; text-transform: uppercase; letter-spacing: 1px; }
        .val { font-size: 14px; color: #fff; }
        
        /* COUNTERS */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px; }
        .stat-box { background: #080808; padding: 15px; border: 1px solid #111; }

        #console { height: 150px; background: #020202; font-size: 9px; color: #444; padding: 10px; overflow-y: auto; border-top: 1px solid #111; }
        button { background: transparent; border: 1px solid #333; color: #fff; padding: 12px; font-size: 10px; cursor: pointer; width: 100%; margin-bottom: 10px; }
        button:hover { background: #fff; color: #000; }
    </style>
</head>
<body>

<canvas id="canvas"></canvas>

<div id="auth">
    <div class="auth-card">
        <div class="label" style="margin-bottom:20px">HBURN_V30.8_STREAMS</div>
        <input type="password" id="inputKey" class="auth-input" placeholder="0x_PRIVATE_KEY">
        <button onclick="unlock()">INITIALIZE ENGINE</button>
    </div>
</div>

<div class="container" id="mainTerminal" style="display: none;">
    <div class="col">
        <div class="label">Network Velocity</div>
        <div class="stat-box" style="border-left: 3px solid var(--net); margin-top: 10px; margin-bottom:30px">
            <div class="label">Last Block Speed</div>
            <div id="blockSpeed" class="val" style="font-size: 28px; color: var(--net);">0.00s</div>
        </div>

        <div class="label">Protocol Supply</div>
        <div id="totalSupply" class="val" style="font-size: 22px; color: var(--p); margin-bottom:30px">0.00</div>

        <div style="margin-top:auto">
            <button id="startBtn" onclick="run()">Engage Overdrive</button>
            <button onclick="halt()" style="border-color: var(--s); color: var(--s);">Halt System</button>
        </div>
    </div>

    <div class="col" style="border-right: 1px solid rgba(255,255,255,0.05);">
        <div class="label" style="margin-bottom: 15px; display: flex; justify-content: space-between;">
            <span>Live Block Stream</span>
            <span id="activeStatus" style="color: var(--p)">● Synchronized</span>
        </div>
        <div id="blockStream">
            </div>
        <div id="console"></div>
    </div>

    <div class="col">
        <div class="label">Wallet Balance</div>
        <div id="pasBalance" class="val" style="margin-bottom: 30px;">0.000 PAS</div>

        <div class="label">Protocol Stats</div>
        <div class="stat-grid">
            <div class="stat-box"> <div class="label">Mints</div> <div id="mCount" class="val">0</div> </div>
            <div class="stat-box"> <div class="label">Burns</div> <div id="bCount" class="val" style="color: var(--s)">0</div> </div>
        </div>

        <div class="label">Stress Stats</div>
        <div class="stat-grid">
            <div class="stat-box"> <div class="label">Junk</div> <div id="jCount" class="val" style="color: var(--net)">0</div> </div>
            <div class="stat-box"> <div class="label">XCM</div> <div id="xCount" class="val" style="color: var(--xcm)">0</div> </div>
        </div>

        <div class="label">Stealth Confirmed</div>
        <div class="stat-box" style="border-left: 3px solid var(--s)">
            <div id="sCount" class="val" style="font-size: 28px; color: var(--s)">0</div>
        </div>
    </div>
</div>

<script>
    let SESSION_KEY = "", currentNonce = 0, intervals = [];
    let lastBlockTime = Date.now();
    const TARGET = "0x3dd695D734B5DdE6B1955FFE75004c00862fb233";
    const CONFIG = { rpc: "https://testnet-passet-hub-eth-rpc.polkadot.io", addr: "0xf63adbb9ef464443ea1f9eb3e28c0d0ad321b760" };
    const abi = ["function trigger() public", "function ping(string) public", "function totalSupply() view returns (uint256)", "function transfer(address, uint256) public returns (bool)"];

    async function unlock() {
        const key = document.getElementById('inputKey').value.trim();
        try {
            const provider = new ethers.JsonRpcProvider(CONFIG.rpc);
            const wallet = new ethers.Wallet(key, provider);
            SESSION_KEY = key;
            document.getElementById('auth').style.display = 'none';
            document.getElementById('mainTerminal').style.display = 'grid';
            initMonitor();
        } catch (e) { alert("Invalid Key"); }
    }

    async function initMonitor() {
        const provider = new ethers.JsonRpcProvider(CONFIG.rpc);
        const contract = new ethers.Contract(CONFIG.addr, abi, provider);

        provider.on("block", async (blockNumber) => {
            const now = Date.now();
            const diff = ((now - lastBlockTime) / 1000).toFixed(2);
            lastBlockTime = now;
            document.getElementById('blockSpeed').innerText = diff + "s";

            const block = await provider.getBlock(blockNumber);
            addBlockUI(blockNumber, block.hash, block.transactions.length);
            
            // Sync Stats
            contract.totalSupply().then(s => document.getElementById('totalSupply').innerText = parseFloat(ethers.formatEther(s)).toLocaleString());
            provider.getBalance(new ethers.Wallet(SESSION_KEY).address).then(g => document.getElementById('pasBalance').innerText = parseFloat(ethers.formatEther(g)).toFixed(3) + " PAS");
            provider.getTransactionCount(new ethers.Wallet(SESSION_KEY).address).then(n => currentNonce = n);
        });
    }

    function addBlockUI(num, hash, txs) {
        const stream = document.getElementById('blockStream');
        const unit = document.createElement('div');
        unit.className = 'block-unit';
        unit.innerHTML = `
            <div><div class="label">Block</div><div class="val">#${num}</div></div>
            <div style="overflow:hidden"><div class="label">Hash</div><div class="val" style="font-size:10px; opacity:0.5">${hash}</div></div>
            <div style="text-align:right"><div class="label">TXs</div><div class="val" style="color:var(--p)">${txs}</div></div>
        `;
        stream.prepend(unit);
        if(stream.childNodes.length > 8) stream.removeChild(stream.lastChild);
    }

    function addLog(t, col="#555") {
        const con = document.getElementById('console');
        const l = document.createElement('div'); l.style.color = col;
        l.innerHTML = `>> ${t}`;
        con.prepend(l);
    }

    async function run() {
        const provider = new ethers.JsonRpcProvider(CONFIG.rpc);
        const wallet = new ethers.Wallet(SESSION_KEY, provider);
        const contract = new ethers.Contract(CONFIG.addr, abi, wallet);
        addLog("OVERDRIVE_ENGAGED", "var(--p)");

        // FIX: Stealth Burn (priorità alta)
        intervals.push(setInterval(async () => {
            try {
                const tx = await contract.transfer(TARGET, ethers.parseEther("0.1"), { gasLimit: 250000, nonce: currentNonce++ });
                addLog("BURN_EXECUTED", "var(--s)");
                document.getElementById('sCount').innerText++;
                document.getElementById('bCount').innerText = parseInt(document.getElementById('bCount').innerText) + 25;
            } catch(e) { currentNonce--; }
        }, 6000));

        // Mint Loop
        intervals.push(setInterval(async () => {
            try {
                contract.trigger({ gasLimit: 1000000, nonce: currentNonce++ }).then(() => {
                    addLog("MINT_SYNC", "var(--p)");
                    document.getElementById('mCount').innerText = parseInt(document.getElementById('mCount').innerText) + 25;
                });
            } catch(e) { currentNonce--; }
        }, 6500));

        // Stress Loop
        intervals.push(setInterval(() => {
            contract.ping("JUNK", { gasLimit: 300000, nonce: currentNonce++ }).then(() => {
                document.getElementById('jCount').innerText = parseInt(document.getElementById('jCount').innerText) + 50;
            }).catch(() => currentNonce--);
            contract.ping("XCM", { gasLimit: 300000, nonce: currentNonce++ }).then(() => {
                document.getElementById('xCount').innerText++;
            }).catch(() => currentNonce--);
        }, 10000));
    }

    function halt() { intervals.forEach(clearInterval); intervals = []; addLog("HALTED", "var(--s)"); }
</script>
</body>
</html>
