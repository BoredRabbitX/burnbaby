<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>BURN_MINIMAL_OS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0f1115; --card: #1a1d23; --primary: #00ff88; --accent: #ff3366; --text: #e0e6ed; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
        .container { width: 900px; height: 600px; display: grid; grid-template-columns: 350px 1fr; gap: 20px; }
        .panel { background: var(--card); border-radius: 12px; padding: 24px; box-sizing: border-box; display: flex; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        h1 { font-size: 14px; text-transform: uppercase; letter-spacing: 2px; color: #636e72; margin-bottom: 24px; font-weight: 600; }
        .stat-group { margin-bottom: 20px; }
        .stat-label { font-size: 11px; color: #636e72; text-transform: uppercase; margin-bottom: 4px; }
        .stat-value { font-family: 'JetBrains Mono', monospace; font-size: 24px; color: #fff; }
        
        .progress-container { height: 6px; background: #2d3436; border-radius: 3px; margin: 10px 0; overflow: hidden; }
        #burnProgress { width: 0%; height: 100%; background: var(--accent); transition: width 0.5s; }

        input { background: #2d3436; border: none; border-radius: 6px; color: #fff; padding: 12px; margin-bottom: 12px; width: 100%; box-sizing: border-box; font-family: 'JetBrains Mono'; font-size: 12px; }
        button { background: var(--primary); color: #000; border: none; border-radius: 6px; padding: 16px; font-weight: 700; cursor: pointer; transition: 0.2s; text-transform: uppercase; letter-spacing: 1px; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }

        #console { flex-grow: 1; background: #00000044; border-radius: 8px; padding: 16px; font-family: 'JetBrains Mono', monospace; font-size: 11px; overflow-y: auto; color: #b2bec3; }
        .m-log { color: var(--primary); }
        .b-log { color: var(--accent); font-weight: bold; }
        .i-log { color: #636e72; }
    </style>
</head>
<body>

<div class="container">
    <div class="panel">
        <h1>Control Unit</h1>
        
        <div class="stat-group">
            <div class="stat-label">Contract Balance</div>
            <div id="cBal" class="stat-value">0.00</div>
        </div>

        <div class="stat-group">
            <div class="stat-label">Minted Total</div>
            <div id="mCount" class="stat-value" style="color: var(--primary);">0</div>
        </div>

        <div class="stat-group">
            <div class="stat-label">Burned Total</div>
            <div id="bCount" class="stat-value" style="color: var(--accent);">0</div>
            <div class="stat-label" style="margin-top:8px; font-size:9px;">Next Burn Cycle</div>
            <div class="progress-container"><div id="burnProgress"></div></div>
        </div>

        <input type="password" id="key" value="e7b0f8447fb5c168c7f2f33e30ed2377aef70a71546c58e4cc3690e62769df12">
        <input type="text" id="addr" value="0x01edfe82fdcc7247e3b614eab68b1ff515e0fb43">
        
        <button id="startBtn">Deploy Protocol</button>
    </div>

    <div class="panel">
        <h1>Live Feed</h1>
        <div id="console">System standby. Awaiting deployment...</div>
    </div>
</div>

<script>
    let mTotal = 0, bTotal = 0, cycles = 0;
    const abi = [
        "function trigger() public",
        "function balanceOf(address) view returns (uint256)",
        "event Transfer(address indexed from, address indexed to, uint256 value)"
    ];

    const log = (msg, cls="") => {
        const c = document.getElementById('console');
        c.innerHTML = `<div class="${cls}">[${new Date().toLocaleTimeString()}] ${msg}</div>` + c.innerHTML;
    };

    document.getElementById('startBtn').onclick = async () => {
        const provider = new ethers.JsonRpcProvider("https://testnet-passet-hub-eth-rpc.polkadot.io");
        const wallet = new ethers.Wallet(document.getElementById('key').value, provider);
        const contract = new ethers.Contract(document.getElementById('addr').value, abi, wallet);

        log("PROTOCOL INITIALIZED", "m-log");
        document.getElementById('startBtn').innerText = "Running...";
        document.getElementById('startBtn').disabled = true;

        contract.on("Transfer", (from, to, value) => {
            const amt = parseFloat(ethers.formatEther(value));
            const cAddr = document.getElementById('addr').value.toLowerCase();
            
            if (from === "0x0000000000000000000000000000000000000000" && to.toLowerCase() === cAddr) {
                mTotal += amt;
                document.getElementById('mCount').innerText = mTotal.toFixed(0);
                log(`MINT: +${amt} units`, "m-log");
            } else if (from.toLowerCase() === cAddr && to === "0x0000000000000000000000000000000000000000") {
                bTotal += amt;
                document.getElementById('bCount').innerText = bTotal.toFixed(0);
                log(`BURN: -${amt} units`, "b-log");
            }
        });

        while(true) {
            try {
                log("Executing trigger...", "i-log");
                const tx = await contract.trigger({ gasLimit: 400000 });
                await tx.wait();
                
                cycles++;
                // Aggiorna progresso Burn (ciclo di 3)
                let progress = (cycles % 3) === 0 ? 100 : (cycles % 3) * 33.3;
                document.getElementById('burnProgress').style.width = progress + "%";
                
                const b = await contract.balanceOf(document.getElementById('addr').value);
                document.getElementById('cBal').innerText = parseFloat(ethers.formatEther(b)).toFixed(2);
                
                log("Network confirmation received", "i-log");
            } catch(e) {
                log("Cooldown active / RPC congestion", "i-log");
            }
            await new Promise(r => setTimeout(r, 61000));
        }
    };
</script>
</body>
</html>
