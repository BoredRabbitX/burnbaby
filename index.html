<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>BURN_TERMINAL_PASEO_v2</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        :root { --neon: #00ff41; --dim: #003b00; --bg: #050505; --warning: #ff003c; }
        body { background: var(--bg); color: var(--neon); font-family: 'Courier New', monospace; margin: 0; overflow: hidden; }
        #terminal { display: flex; flex-direction: column; height: 100vh; padding: 20px; box-sizing: border-box; border: 2px solid var(--neon); box-shadow: inset 0 0 20px var(--dim); }
        .header { text-shadow: 0 0 10px var(--neon); border-bottom: 2px solid var(--neon); padding-bottom: 10px; margin-bottom: 20px; font-weight: bold; display: flex; justify-content: space-between; }
        .grid { display: grid; grid-template-columns: 420px 1fr; gap: 20px; flex-grow: 1; min-height: 0; }
        .panel { border: 1px solid var(--neon); padding: 15px; background: rgba(0, 255, 65, 0.03); display: flex; flex-direction: column; }
        .input-box { margin-bottom: 15px; }
        label { display: block; font-size: 10px; margin-bottom: 5px; color: var(--dim); font-weight: bold; text-transform: uppercase; }
        input { background: #000; border: 1px solid var(--dim); color: #fff; width: 100%; padding: 8px; outline: none; box-sizing: border-box; font-size: 12px; }
        input:focus { border-color: var(--neon); }
        button { background: var(--neon); color: black; border: none; padding: 15px; width: 100%; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 14px; transition: 0.3s; }
        button:hover { background: #fff; box-shadow: 0 0 20px var(--neon); }
        #console { background: #000; border: 1px solid var(--dim); height: 100%; overflow-y: auto; padding: 10px; font-size: 11px; color: var(--neon); }
        .stat { font-size: 20px; margin: 10px 0; border-left: 4px solid var(--neon); padding-left: 10px; }
        .stat span { color: #fff; }
        .tx-success { color: #00ff41; font-weight: bold; }
        .tx-error { color: var(--warning); }
        .tx-pending { color: #008cff; }
    </style>
</head>
<body>
    <div id="terminal">
        <div class="header">
            <span>[ SYSTEM: PASEO_ASSETHUB_SPAMMER ]</span>
            <span id="clock">00:00:00</span>
        </div>
        
        <div class="grid">
            <div class="panel">
                <div class="stat">BURN_BAL: <span id="balDisp">0.00</span></div>
                <div class="stat">TX_SENT: <span id="txCount">0</span></div>
                <div class="stat">STATUS: <span id="statusDisp" style="color: #666;">IDLE</span></div>
                
                <div style="margin-top: 20px;">
                    <div class="input-box">
                        <label>Target RPC</label>
                        <input type="text" id="rpcUrl" value="https://testnet-passet-hub-eth-rpc.polkadot.io">
                    </div>
                    <div class="input-box">
                        <label>Private Key</label>
                        <input type="password" id="privKey" value="e7b0f8447fb5c168c7f2f33e30ed2377aef70a71546c58e4cc3690e62769df12">
                    </div>
                    <div class="input-box">
                        <label>Contract Address</label>
                        <input type="text" id="contractAddr" value="0x459739728d2FAfE3Bc23e507B703304DdF7ab102">
                    </div>
                    <button id="startBtn">EXECUTE_BURN_SEQUENCE</button>
                </div>
            </div>

            <div class="panel">
                <div id="console">> TERMINAL READY. WAITING FOR COMMAND...</div>
            </div>
        </div>
    </div>

<script>
    let txCounter = 0;
    const abi = [
        "function trigger() public",
        "function balanceOf(address) view returns (uint256)"
    ];

    function updateClock() {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString();
    }
    setInterval(updateClock, 1000);

    const log = (msg, className = "") => {
        const c = document.getElementById('console');
        const entry = document.createElement('div');
        entry.className = className;
        entry.innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}`;
        c.prepend(entry);
    };

    document.getElementById('startBtn').onclick = async () => {
        const rpc = document.getElementById('rpcUrl').value;
        const key = document.getElementById('privKey').value;
        const addr = document.getElementById('contractAddr').value;

        try {
            const provider = new ethers.JsonRpcProvider(rpc);
            const wallet = new ethers.Wallet(key, provider);
            const contract = new ethers.Contract(addr, abi, wallet);

            log(">>> INIZIALIZZAZIONE PROTOCOLLO...", "tx-pending");
            document.getElementById('statusDisp').innerText = "RUNNING";
            document.getElementById('statusDisp').style.color = "var(--neon)";

            runSpam(contract, wallet, provider);
        } catch (e) {
            log("ERRORE CRITICO: " + e.message, "tx-error");
        }
    };

    async function runSpam(contract, wallet, provider) {
        while (true) {
            try {
                log("SINCRONIZZAZIONE NONCE...");
                const nonce = await provider.getTransactionCount(wallet.address, "latest");
                
                log("INVIO PAYLOAD 'TRIGGER'...", "tx-pending");
                
                // Su AssetHub forziamo gasLimit e gasPrice per bypassare blocchi RPC
                const tx = await contract.trigger({
                    nonce: nonce,
                    gasLimit: 300000 
                });

                log(`BROADCAST RIUSCITO: ${tx.hash.substring(0,24)}...`, "tx-success");
                
                await tx.wait();
                txCounter++;
                document.getElementById('txCount').innerText = txCounter;
                
                const bal = await contract.balanceOf(wallet.address);
                document.getElementById('balDisp').innerText = ethers.formatEther(bal);
                
                log("CONFERMA RICEVUTA. ATTESA COOLDOWN 61s.", "tx-success");
            } catch (e) {
                log("FALLIMENTO: " + (e.reason || "Errore RPC / Cooldown attivo"), "tx-error");
            }
            await new Promise(r => setTimeout(r, 61000));
        }
    }
</script>
</body>
</html>
