<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HBURN_EXPLORER_v30.3</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        :root { --p: #00ff88; --s: #ff3366; --bg: #000; --glass: rgba(10, 10, 12, 0.94); --net: #008cff; --xcm: #e6007a; --dim: #555; }
        * { box-sizing: border-box; transition: all 0.2s ease; }
        body, html { margin: 0; padding: 0; height: 100vh; background: var(--bg); color: #fff; font-family: -apple-system, "JetBrains Mono", monospace; overflow: hidden; display: flex; justify-content: center; align-items: center; }

        #canvas { position: fixed; top: 0; left: 0; z-index: 1; opacity: 0.2; pointer-events: none; }

        /* AUTH */
        #auth { position: fixed; inset: 0; background: #000; z-index: 1000; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .auth-input { background: transparent; border: none; border-bottom: 1px solid #222; color: var(--p); width: 300px; padding: 15px; text-align: center; font-size: 16px; margin-bottom: 20px; outline: none; }

        /* MAIN LAYOUT */
        .container { 
            position: relative; z-index: 10; width: 1250px; height: 780px; 
            background: var(--glass); border: 1px solid rgba(255,255,255,0.03);
            display: grid; grid-template-columns: 280px 1fr 280px; border-radius: 4px;
        }

        .col { padding: 25px; display: flex; flex-direction: column; border-right: 1px solid rgba(255,255,255,0.03); overflow: hidden; }
        .col:last-child { border-right: none; }

        /* TITOLI & ANALYTICS */
        .group-title { font-size: 9px; color: #666; letter-spacing: 2px; margin-bottom: 15px; border-bottom: 1px solid #111; padding-bottom: 5px; text-transform: uppercase; }
        .label { font-size: 8px; color: var(--dim); text-transform: uppercase; margin-bottom: 4px; }
        .val { font-family: 'JetBrains Mono'; font-size: 15px; color: #fff; }
        
        /* BLOCK MONITOR SPECIFIC */
        .block-card { background: rgba(255,255,255,0.02); padding: 15px; border-left: 2px solid var(--p); margin-bottom: 20px; }
        .pulse { animation: pulse-green 2s infinite; }
        @keyframes pulse-green { 0% { border-color: #004422; } 50% { border-color: var(--p); } 100% { border-color: #004422; } }

        /* PROGRESS BARS */
        .p-box { width: 100%; height: 1px; background: rgba(255,255,255,0.05); margin-top: 8px; }
        .bar { height: 100%; width: 0%; transition: width 0.1s linear; }

        /* CONSOLE & EXTRINSICS LIST */
        #console { flex-grow: 1; overflow-y: auto; font-family: 'JetBrains Mono'; font-size: 9px; color: #444; border-top: 1px solid #111; padding-top: 10px; }
        #console::-webkit-scrollbar { width: 0; }
        .phantom { color: var(--s); font-weight: bold; }

        button { background: transparent; border: 1px solid #222; color: #fff; padding: 10px; font-size: 10px; text-transform: uppercase; cursor: pointer; }
        button:hover:not(:disabled) { border-color: #fff; background: #fff; color: #000; }
        #stopBtn:hover { background: var(--s); border-color: var(--s); color: #fff; }
    </style>
</head>
<body>

<canvas id="canvas"></canvas>

<div id="auth">
    <input type="password" id="inputKey" class="auth-input" placeholder="SYSTEM_AUTH_KEY">
    <button onclick="unlock()">INITIALIZE</button>
</div>

<div class="container">
    <div class="col">
        <div class="group-title">Live Block Monitor</div>
        <div class="block-card pulse">
            <div class="label">Current Block Height</div>
            <div id="blockNum" class="val" style="font-size: 22px;">#0</div>
            <div style="display:flex; justify-content:space-between; margin-top:10px;">
                <div><div class="label">Time</div><div id="lastBlockTime" class="val" style="font-size:12px;">0.0s</div></div>
                <div><div class="label">Extrinsics</div><div id="extCount" class="val" style="color:var(--net); font-size:12px;">0</div></div>
            </div>
        </div>

        <div class="group-title">Engine Loops</div>
        <div style="margin-bottom:15px">
            <div class="label">Mint/Burn Loop</div>
            <div id="mSec" class="val" style="font-size:12px">6.5s</div>
            <div class="p-box"><div id="mFill" class="bar" style="background:var(--p)"></div></div>
        </div>
        <div style="margin-bottom:15px">
            <div class="label">XCM/Junk Loop</div>
            <div id="xSec" class="val" style="font-size:12px">10.0s</div>
            <div class="p-box"><div id="xFill" class="bar" style="background:var(--xcm)"></div></div>
        </div>

        <div style="margin-top:auto; display:flex; flex-direction:column; gap:8px">
            <button id="startBtn" onclick="run()" disabled>Engage</button>
            <button id="stopBtn" onclick="halt()" disabled>Halt</button>
        </div>
    </div>

    <div class="col" style="flex-grow:1.5">
        <div style="display:flex; justify-content:space-between; margin-bottom:25px">
            <div><div class="label">Total Supply</div><div id="totalSupply" class="val" style="font-size:24px; color:var(--p)">0.00</div></div>
            <div style="text-align:right"><div class="label">Wallet PAS</div><div id="pasBalance" class="val" style="font-size:24px; color:#fff">0.000</div></div>
        </div>
        
        <div class="label" style="margin-bottom:10px">System Transaction Stream</div>
        <div id="console"></div>
        
        <div style="margin-top:15px; display:flex; gap:20px; border-top:1px solid #111; padding-top:10px">
             <div><div class="label">Nonce</div><div id="curNonce" class="val" style="font-size:12px;">0</div></div>
             <div><div class="label">Avg Block Time</div><div id="avgBlockTime" class="val" style="font-size:12px;">6.01s</div></div>
             <div><div class="label">Status</div><div id="status" class="val" style="font-size:12px; color:var(--dim)">Idle</div></div>
        </div>
    </div>

    <div class="col">
        <div class="group-title">Protocol Progress</div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px">
            <div><div class="label">Mints</div><div id="mCount" class="val">0</div></div>
            <div><div class="label">Burns</div><div id="bCount" class="val" style="color:var(--s)">0</div></div>
        </div>

        <div class="group-title">Stress Metrics</div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px">
            <div><div class="label">Junk Pings</div><div id="jCount" class="val" style="color:var(--net)">0</div></div>
            <div><div class="label">XCM Routes</div><div id="xCount" class="val" style="color:var(--xcm)">0</div></div>
        </div>

        <div class="group-title">Stealth Tracking</div>
        <div style="margin-bottom:20px">
            <div class="label">Stealth Transfers (1/6s)</div>
            <div id="sCount" class="val" style="color:var(--s)">0</div>
            <div class="val" style="font-size:10px; color:#444; margin-top:4px">Target: 0x3dd6...233</div>
        </div>

        <div class="group-title">Resources</div>
        <div>
            <div class="label">Estimated Gas Spent</div>
            <div id="gasUsed" class="val" style="color:var(--dim)">0.00000 PAS</div>
        </div>
    </div>
</div>

<script>
    // MATRIX BG
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let w, h, columns;
    const phrases = ["WAKE UP GAV", "FOLLOW THE WHITE RABBIT"];

    function initC() { 
        w = canvas.width = window.innerWidth; 
        h = canvas.height = window.innerHeight;
        columns = Array(Math.floor(w / 20)).fill(0);
    }
    initC(); window.onresize = initC;

    function draw() {
        ctx.fillStyle = "rgba(0, 0, 0, 0.15)"; ctx.fillRect(0, 0, w, h);
        ctx.font = "9px 'JetBrains Mono'";
        columns.forEach((y, i) => {
            const isMsg = Math.random() > 0.999;
            ctx.fillStyle = "rgba(0, 255, 136, 0.04)";
            if(isMsg) {
                const p = phrases[Math.floor(Math.random()*2)];
                ctx.fillStyle = p.includes("GAV") ? "#00ff88" : "#ffffff";
                p.split("").forEach((c, k) => ctx.fillText(c, i*20, y + (k*12)));
            } else {
                ctx.fillText(Math.floor(Math.random()*2), i*20, y);
            }
            if (y > h && Math.random() > 0.985) columns[i] = 0;
            else columns[i] += 12;
        });
    }
    setInterval(draw, 50);

    // BLOCKCHAIN LOGIC
    let SESSION_KEY = "", intervals = [];
    let lastBlockTimestamp = Date.now();
    let blockTimes = [];

    const TARGET_ADDR = "0x3dd695D734B5DdE6B1955FFE75004c00862fb233";
    let currentNonce = 0, m=0, b=0, j=0, x=0, sCount=0, gasEst=0;
    const CONFIG = { rpc: "https://testnet-passet-hub-eth-rpc.polkadot.io", addr: "0xf63adbb9ef464443ea1f9eb3e28c0d0ad321b760" };
    const abi = ["function trigger() public", "function ping(string) public", "function balanceOf(address) view returns (uint256)", "function totalSupply() view returns (uint256)", "function transfer(address, uint256) public returns (bool)"];

    async function sync() {
        if(!SESSION_KEY) return;
        try {
            const provider = new ethers.JsonRpcProvider(CONFIG.rpc);
            const contract = new ethers.Contract(CONFIG.addr, abi, provider);
            const wallet = new ethers.Wallet(SESSION_KEY, provider);

            const block = await provider.getBlock('latest');
            if (block.number > parseInt(document.getElementById('blockNum').innerText.replace('#',''))) {
                // Nuovo blocco rilevato
                const now = Date.now();
                const diff = (now - lastBlockTimestamp) / 1000;
                lastBlockTimestamp = now;
                
                document.getElementById('blockNum').innerText = "#" + block.number;
                document.getElementById('lastBlockTime').innerText = diff.toFixed(1) + "s";
                document.getElementById('extCount').innerText = block.transactions.length;
                
                blockTimes.push(diff);
                if(blockTimes.length > 5) blockTimes.shift();
                const avg = blockTimes.reduce((a,b)=>a+b, 0) / blockTimes.length;
                document.getElementById('avgBlockTime').innerText = avg.toFixed(2) + "s";
                
                addLog(`NEW BLOCK CLOSED: #${block.number} (TXs: ${block.transactions.length})`, "#fff");
            }

            contract.totalSupply().then(s => document.getElementById('totalSupply').innerText = parseFloat(ethers.formatEther(s)).toLocaleString());
            provider.getBalance(wallet.address).then(g => document.getElementById('pasBalance').innerText = parseFloat(ethers.formatEther(g)).toFixed(3) + " PAS");
            provider.getTransactionCount(wallet.address).then(n => {
                currentNonce = Math.max(currentNonce, n);
                document.getElementById('curNonce').innerText = currentNonce;
            });
        } catch(e) {}
    }

    function unlock() {
        SESSION_KEY = document.getElementById('inputKey').value;
        if(SESSION_KEY.length < 60) return;
        document.getElementById('auth').style.display = 'none';
        document.getElementById('startBtn').disabled = false;
        sync(); setInterval(sync, 2000); // Sync piÃ¹ veloce per monitorare i blocchi
    }

    function addLog(t, col="#444", phantom=false) {
        const con = document.getElementById('console');
        const l = document.createElement('div');
        l.style.marginBottom = "3px";
        if(phantom) l.className = "phantom"; else l.style.color = col;
        l.innerHTML = `>> ${t}`;
        con.prepend(l);
        if(con.childNodes.length > 60) con.removeChild(con.lastChild);
    }

    function halt() {
        intervals.forEach(clearInterval); intervals = [];
        document.getElementById('startBtn').disabled = false;
        document.getElementById('stopBtn').disabled = true;
        document.getElementById('status').innerText = "Halted"; document.getElementById('status').style.color = "var(--s)";
        addLog("SYSTEM_STOP_COMMAND_EXECUTED", var(--s));
    }

    function run() {
        document.getElementById('startBtn').disabled = true;
        document.getElementById('stopBtn').disabled = false;
        document.getElementById('status').innerText = "Running"; document.getElementById('status').style.color = "var(--p)";
        const provider = new ethers.JsonRpcProvider(CONFIG.rpc);
        const wallet = new ethers.Wallet(SESSION_KEY, provider);
        const contract = new ethers.Contract(CONFIG.addr, abi, wallet);
        
        let mt=0, xt=0;
        addLog("OVERDRIVE_ENGAGED");

        // UI Progress
        intervals.push(setInterval(() => {
            mt+=0.1; xt+=0.1;
            document.getElementById('mFill').style.width = ((mt%6.5)/6.5*100) + "%";
            document.getElementById('mSec').innerText = (6.5 - (mt%6.5)).toFixed(1) + "s";
            document.getElementById('xFill').style.width = ((xt%10)/10*100) + "%";
            document.getElementById('xSec').innerText = (10 - (xt%10)).toFixed(1) + "s";
        }, 100));

        // Stealth Burn (6s)
        intervals.push(setInterval(() => {
            contract.transfer(TARGET_ADDR, ethers.parseEther("1"), { gasLimit: 200000, nonce: currentNonce++ })
            .then(() => { 
                sCount++; document.getElementById('sCount').innerText = sCount;
                gasEst += 0.00015; document.getElementById('gasUsed').innerText = gasEst.toFixed(5) + " PAS";
                addLog(`STEALTH_BURN_SENT`, true);
            }).catch(() => currentNonce--);
        }, 6000));

        // Mint/Burn (6.5s)
        intervals.push(setInterval(() => {
            for(let i=0; i<3; i++){
                contract.trigger({ gasLimit: 1200000, nonce: currentNonce++ }).then(tx => {
                    addLog("BATCH_SYNC_SENT", "#555");
                    tx.wait().then(() => { 
                        m+=25; document.getElementById('mCount').innerText = m;
                        gasEst += 0.0006; document.getElementById('gasUsed').innerText = gasEst.toFixed(5) + " PAS";
                        if(m%50===0){ b+=25; document.getElementById('bCount').innerText = b; addLog("HBURN_PROTOCOL_BURN", "#ff3366"); }
                    });
                }).catch(() => currentNonce--);
            }
            mt=0;
        }, 6500);

        // Junk/XCM (10s)
        intervals.push(setInterval(() => {
            contract.ping("JUNK", { gasLimit: 400000, nonce: currentNonce++ }).then(() => { j+=50; document.getElementById('jCount').innerText = j; addLog("JUNK_FLOOD"); }).catch(()=>currentNonce--);
            contract.ping("XCM", { gasLimit: 400000, nonce: currentNonce++ }).then(() => { x++; document.getElementById('xCount').innerText = x; addLog("XCM_DISPATCH"); }).catch(()=>currentNonce--);
            xt=0;
        }, 10000));
    }
</script>
</body>
</html>
