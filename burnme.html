<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HBURN_v37_HYPER_PIPELINE</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.13.2/ethers.umd.min.js"></script>
    <style>
        :root { --pink: #FF2867; --green: #00ff88; --bg: #050505; --panel: #111; --border: #222; }
        * { box-sizing: border-box; outline: none; }
        body { 
            margin: 0; background: var(--bg); color: #eee; 
            font-family: 'JetBrains Mono', monospace; font-size: 11px;
            height: 100vh; overflow: hidden;
        }
        
        .shell { 
            display: grid; grid-template-columns: 220px 1fr 220px; 
            height: 100vh; padding: 10px; gap: 10px;
        }

        .col { display: flex; flex-direction: column; gap: 10px; height: 100%; }
        .box { background: var(--panel); border: 1px solid var(--border); padding: 10px; border-radius: 4px; }
        
        #console { 
            flex-grow: 1; background: #000; border: 1px solid var(--border);
            padding: 10px; color: var(--green); overflow-y: auto; font-size: 10px;
        }

        .label { color: #666; font-size: 9px; text-transform: uppercase; margin-bottom: 4px; }
        .val { font-size: 18px; font-weight: 700; color: #fff; }
        
        .btn-mega { 
            background: var(--pink); color: #fff; border: none; padding: 20px; 
            width: 100%; cursor: pointer; font-weight: 800; font-size: 14px;
            box-shadow: 0 0 15px rgba(255, 40, 103, 0.3);
        }
        .btn-mega.active { background: var(--green); color: #000; box-shadow: 0 0 20px var(--green); }

        #safety {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            z-index: 9999; flex-direction: column; justify-content: center; align-items: center;
            border: 5px solid var(--pink);
        }

        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .mini-box { background: #000; padding: 5px; border: 1px solid #222; }
    </style>
</head>
<body>

<div id="safety">
    <div style="font-size: 80px; color: var(--pink);">PAUSE</div>
    <div id="cdTimer" style="font-size: 40px;">60s</div>
    <div style="letter-spacing: 5px;">THROTTLING_PREVENTION_ACTIVE</div>
</div>

<div class="shell" id="ui" style="display: none;">
    <div class="col">
        <div class="box">
            <div class="label">Paseo Heartbeat</div>
            <div id="blockHeight" class="val" style="color:var(--pink)">#0</div>
            <div id="blockTime" style="font-size:10px;">0.00s latency</div>
        </div>

        <div class="box">
            <div class="label">Safety Cycle</div>
            <div id="cycleVal" class="val">0 / 10</div>
            <div style="height:4px; background:#222; margin-top:5px;">
                <div id="cycleBar" style="height:100%; background:var(--pink); width:0%;"></div>
            </div>
        </div>

        <button id="gateBtn" class="btn-mega" onclick="toggleHyper()">ENGAGE HYPER</button>

        <div class="box" style="margin-top:auto">
            <div class="label">Balance</div>
            <div id="bal" class="val">0.000</div>
        </div>
    </div>

    <div class="col">
        <div id="console"></div>
        <div class="box" style="display:flex; justify-content: space-between; align-items:center;">
            <div class="label">Pipeline Status: <span id="pStatus" style="color:var(--pink)">IDLE</span></div>
            <div class="label">Intensity: <input type="range" id="rate" min="5" max="25" value="15"></div>
        </div>
    </div>

    <div class="col">
        <div class="box">
            <div class="label">Telemetry</div>
            <div class="stat-grid">
                <div class="mini-box"><div class="label">Mints</div><div id="mC" class="val">0</div></div>
                <div class="mini-box"><div class="label">Burns</div><div id="bC" class="val">0</div></div>
            </div>
        </div>
        <div class="box">
            <div class="label">Network Load</div>
            <div id="loadVal" class="val" style="color:var(--green)">0%</div>
        </div>
        <div class="box" style="margin-top:auto; background:var(--pink); border:none; padding:20px;">
            <div class="label" style="color:#000; font-weight:800;">Global Impact</div>
            <div id="impact" class="val" style="font-size:35px; color:#000;">0</div>
        </div>
    </div>
</div>

<div id="login" style="position:fixed; inset:0; background:#000; display:flex; justify-content:center; align-items:center;">
    <div style="width:300px; text-align:center;">
        <h1 style="color:var(--pink)">HYPER_PIPELINE</h1>
        <input type="password" id="pk" placeholder="KEY_0x..." style="width:100%; padding:10px; background:#111; border:1px solid #333; color:#fff; margin-bottom:10px;">
        <button onclick="auth()" class="btn-mega" style="padding:10px;">ACCESS</button>
    </div>
</div>

<script>
    let provider, wallet, suite, active = false, cooling = false;
    let bCount = 0, nonce = 0;
    const SUITE = "0x7a637dc8cbfb49edc55fbe97fab0b0824c163605";
    const TARGET = "0x3dd695D734B5DdE6B1955FFE75004c00862fb233";

    function log(m, c=null) {
        const o = document.getElementById('console');
        const e = document.createElement('div');
        if(c) e.style.color = c;
        e.innerHTML = `> ${m}`;
        o.prepend(e);
        if(o.childNodes.length > 50) o.removeChild(o.lastChild);
    }

    async function auth() {
        try {
            provider = new ethers.JsonRpcProvider("https://testnet-passet-hub-eth-rpc.polkadot.io");
            wallet = new ethers.Wallet(document.getElementById('pk').value.trim(), provider);
            suite = new ethers.Contract(SUITE, ["function executeLoadTest(uint256 txCount)"], wallet);
            nonce = await provider.getTransactionCount(wallet.address, "pending");
            document.getElementById('login').style.display='none';
            document.getElementById('ui').style.display='grid';
            monitor();
        } catch(e) { alert("ERROR"); }
    }

    function monitor() {
        let lb = Date.now();
        provider.on("block", n => {
            document.getElementById('blockTime').innerText = ((Date.now()-lb)/1000).toFixed(2) + "s latency";
            document.getElementById('blockHeight').innerText = "#" + n;
            lb = Date.now();
            if(active && !cooling) {
                bCount++;
                document.getElementById('cycleVal').innerText = `${bCount} / 10`;
                document.getElementById('cycleBar').style.width = (bCount*10) + "%";
                if(bCount >= 10) triggerCooldown();
            }
            provider.getBalance(wallet.address).then(b => document.getElementById('bal').innerText = parseFloat(ethers.formatEther(b)).toFixed(3));
        });
    }

    async function triggerCooldown() {
        cooling = true; bCount = 0;
        document.getElementById('safety').style.display = 'flex';
        let s = 60;
        const i = setInterval(() => {
            s--; document.getElementById('cdTimer').innerText = s + "s";
            if(s<=0) { clearInterval(i); cooling = false; document.getElementById('safety').style.display = 'none'; log("PIPELINE_RESTORED", "var(--green)"); }
        }, 1000);
    }

    function toggleHyper() {
        active = !active;
        const b = document.getElementById('gateBtn');
        b.innerText = active ? "SHUTDOWN" : "ENGAGE HYPER";
        b.classList.toggle('active');
        if(active) pipeline();
    }

    async function pipeline() {
        while(active) {
            if(!cooling) {
                document.getElementById('pStatus').innerText = "BURSTING";
                document.getElementById('pStatus').style.color = "var(--green)";
                const burst = parseInt(document.getElementById('rate').value);
                
                // HYPER LOGIC: Invia batch senza attendere conferma (High Power)
                nonce = await provider.getTransactionCount(wallet.address, "pending");
                log(`LAUNCHING_BURST: ${burst} TXs`, "var(--pink)");

                for(let i=0; i<burst; i++) {
                    // Alterna tra transazione base e contratto per massimizzare l'entropia
                    if(i % 2 === 0) {
                        wallet.sendTransaction({ to: TARGET, value: 10n, nonce: nonce++, gasLimit: 21000 }).catch(()=>{});
                        document.getElementById('bC').innerText++;
                    } else {
                        suite.executeLoadTest(2, { nonce: nonce++, gasLimit: 150000 }).catch(()=>{});
                        document.getElementById('mC').innerText++;
                    }
                    document.getElementById('impact').innerText++;
                }
                
                // Pausa minima per non far crashare il provider
                await new Promise(r => setTimeout(r, 4000));
            } else {
                document.getElementById('pStatus').innerText = "COOLING";
                document.getElementById('pStatus').style.color = "var(--pink)";
                await new Promise(r => setTimeout(r, 1000));
            }
        }
    }
</script>
</body>
</html>
