<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HBURN_v38_SUPERNOVA_X10</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.13.2/ethers.umd.min.js"></script>
    <style>
        :root { --pink: #FF2867; --green: #00ff88; --bg: #020202; --panel: #0a0a0a; --border: #1a1a1a; }
        * { box-sizing: border-box; outline: none; }
        body { 
            margin: 0; background: var(--bg); color: #ccc; 
            font-family: 'JetBrains Mono', monospace; font-size: 10px;
            height: 100vh; overflow: hidden;
        }
        
        .shell { display: grid; grid-template-columns: 200px 1fr 200px; height: 100vh; padding: 5px; gap: 8px; }
        .col { display: flex; flex-direction: column; gap: 8px; }
        .box { background: var(--panel); border: 1px solid var(--border); padding: 8px; border-radius: 2px; }
        
        #console { flex-grow: 1; background: #000; border: 1px solid var(--border); padding: 8px; color: var(--green); overflow-y: auto; font-size: 9px; }
        .label { color: #555; font-size: 8px; text-transform: uppercase; margin-bottom: 2px; font-weight: 800; }
        .val { font-size: 16px; font-weight: 800; color: #fff; }
        
        .btn-massive { 
            background: #222; color: #fff; border: 1px solid #333; padding: 15px; 
            width: 100%; cursor: pointer; font-weight: 800; font-size: 12px; transition: 0.2s;
        }
        .btn-massive.active { background: var(--pink); color: #fff; border: none; box-shadow: 0 0 30px rgba(255, 40, 103, 0.5); animation: flash 0.5s infinite alternate; }
        @keyframes flash { from { opacity: 1; } to { opacity: 0.7; } }

        #safety {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98);
            z-index: 9999; flex-direction: column; justify-content: center; align-items: center;
        }

        .bar-bg { height: 2px; background: #111; margin-top: 4px; width: 100%; }
        #cycleBar { height: 100%; background: var(--pink); width: 0%; transition: width 0.3s; }
    </style>
</head>
<body>

<div id="safety">
    <div style="font-size: 60px; color: var(--pink); font-weight: 800;">PROTOCOL_PAUSE</div>
    <div id="cdTimer" style="font-size: 30px; margin: 20px 0;">60s</div>
    <div style="color: #444; letter-spacing: 10px;">BLOCK_LIMIT_REACHED</div>
</div>

<div class="shell" id="ui" style="display: none;">
    <div class="col">
        <div class="box">
            <div class="label">Net Heartbeat</div>
            <div id="blockHeight" class="val" style="color:var(--pink)">#0</div>
            <div id="blockTime" style="font-size:9px; color:#444;">LATENCY: 0.00s</div>
        </div>

        <div class="box">
            <div class="label">Cycle Integrity</div>
            <div id="cycleVal" class="val">0 / 10</div>
            <div class="bar-bg"><div id="cycleBar"></div></div>
        </div>

        <button id="gateBtn" class="btn-massive" onclick="toggleSupernova()">START SUPERNOVA</button>
        
        <div class="box" style="margin-top:auto">
            <div class="label">Burst Magnitude</div>
            <input type="range" id="rate" min="50" max="250" value="100" style="width:100%">
            <div id="rateVal" style="text-align:center; color:var(--pink); font-weight:800; margin-top:5px;">100 TX/BATCH</div>
        </div>
    </div>

    <div class="col">
        <div id="console"></div>
        <div class="box" style="display:flex; justify-content: space-between; align-items:center;">
            <div class="label">Stream: <span id="pStatus" style="color:var(--pink)">STDBY</span></div>
            <div id="bal" class="val" style="font-size:12px;">0.000 PAS</div>
        </div>
    </div>

    <div class="col">
        <div class="box">
            <div class="label">Impact Metrics</div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:4px;">
                <div style="background:#000; padding:4px;"><div class="label">Mints</div><div id="mC" class="val">0</div></div>
                <div style="background:#000; padding:4px;"><div class="label">Burns</div><div id="bC" class="val">0</div></div>
            </div>
        </div>
        <div class="box">
            <div class="label">Success Rate</div>
            <div id="loadVal" class="val" style="color:var(--green)">100%</div>
        </div>
        <div class="box" style="margin-top:auto; background:var(--pink); color:#000; border:none; padding:15px; text-align:center;">
            <div class="label" style="color:rgba(0,0,0,0.5)">Mass Displacement</div>
            <div id="impact" class="val" style="font-size:30px; color:#000;">0</div>
        </div>
    </div>
</div>

<div id="login" style="position:fixed; inset:0; background:#000; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:10000;">
    <h1 style="color:var(--pink); letter-spacing:10px;">SUPERNOVA</h1>
    <input type="password" id="pk" placeholder="ENTER_PRIVATE_KEY" style="width:280px; padding:12px; background:#050505; border:1px solid #222; color:#fff; font-family:'JetBrains Mono'; margin-bottom:10px; text-align:center;">
    <button onclick="auth()" class="btn-massive" style="width:280px; padding:10px;">ENGAGE</button>
</div>

<script>
    let provider, wallet, suite, active = false, cooling = false;
    let bCount = 0, nonce = 0;
    const SUITE = "0x7a637dc8cbfb49edc55fbe97fab0b0824c163605";
    const TARGET = "0x3dd695D734B5DdE6B1955FFE75004c00862fb233";

    function log(m, c=null) {
        const o = document.getElementById('console');
        const e = document.createElement('div');
        if(c) e.style.color = c;
        e.innerHTML = `> ${m}`;
        o.prepend(e);
        if(o.childNodes.length > 60) o.removeChild(o.lastChild);
    }

    async function auth() {
        try {
            provider = new ethers.JsonRpcProvider("https://testnet-passet-hub-eth-rpc.polkadot.io");
            wallet = new ethers.Wallet(document.getElementById('pk').value.trim(), provider);
            suite = new ethers.Contract(SUITE, ["function executeLoadTest(uint256 txCount)"], wallet);
            nonce = await provider.getTransactionCount(wallet.address, "pending");
            document.getElementById('login').style.display='none';
            document.getElementById('ui').style.display='grid';
            monitor();
        } catch(e) { alert("AUTH_FAIL"); }
    }

    function monitor() {
        let lb = Date.now();
        provider.on("block", n => {
            document.getElementById('blockTime').innerText = `LATENCY: ${((Date.now()-lb)/1000).toFixed(2)}s`;
            document.getElementById('blockHeight').innerText = "#" + n;
            lb = Date.now();
            if(active && !cooling) {
                bCount++;
                document.getElementById('cycleVal').innerText = `${bCount} / 10`;
                document.getElementById('cycleBar').style.width = (bCount*10) + "%";
                if(bCount >= 10) triggerSafety();
            }
            provider.getBalance(wallet.address).then(b => document.getElementById('bal').innerText = parseFloat(ethers.formatEther(b)).toFixed(3) + " PAS");
        });
    }

    async function triggerSafety() {
        cooling = true; bCount = 0;
        document.getElementById('safety').style.display = 'flex';
        let s = 60;
        const i = setInterval(() => {
            s--; document.getElementById('cdTimer').innerText = s + "s";
            if(s<=0) { clearInterval(i); cooling = false; document.getElementById('safety').style.display = 'none'; log("STREAM_RE-ENGAGED", "var(--green)"); }
        }, 1000);
    }

    function toggleSupernova() {
        active = !active;
        const b = document.getElementById('gateBtn');
        b.innerText = active ? "ABORT_STREAM" : "START SUPERNOVA";
        b.classList.toggle('active');
        if(active) burstStream();
    }

    async function burstStream() {
        while(active) {
            if(!cooling) {
                document.getElementById('pStatus').innerText = "STREAM_ACTIVE";
                const magnitude = parseInt(document.getElementById('rate').value);
                nonce = await provider.getTransactionCount(wallet.address, "pending");
                
                log(`MEGA_BURST: ${magnitude} TX_PROJECTED`, "var(--pink)");

                for(let i=0; i < magnitude; i++) {
                    // Distribuzione ultra-veloce senza attesa
                    if(i % 5 === 0) {
                        suite.executeLoadTest(5, { nonce: nonce++, gasLimit: 500000 }).catch(()=>{});
                        document.getElementById('mC').innerText++;
                    } else {
                        wallet.sendTransaction({ to: TARGET, value: 5n, nonce: nonce++, gasLimit: 21000 }).catch(()=>{});
                        document.getElementById('bC').innerText++;
                    }
                    document.getElementById('impact').innerText++;
                }
                
                // Pausa minima per permettere al mempool di assorbire il colpo
                await new Promise(r => setTimeout(r, 6000));
            } else {
                document.getElementById('pStatus').innerText = "STREAM_PAUSED";
                await new Promise(r => setTimeout(r, 1000));
            }
        }
    }

    document.getElementById('rate').oninput = function() {
        document.getElementById('rateVal').innerText = this.value + " TX/BATCH";
    }
</script>
</body>
</html>
